- name: Install Docker and Configure Docker Swarm
  hosts: docker_servers
  become: yes
  become_user: root

  vars:
    elastic-token: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35646565313334333532346366643463323665663832373934623331636338313034353364396336
          3262323839326337353134633861363936333332656666360a376664343436643937633330356361
          38306466313938346564626533303333643433333931343564356435643061373630353138333263
          3165343261356139380a633233623238396636656365396461353438363635393163343564633130
          61393231333362373731323839383465353632663136386635633564633732363339626537643263
          32383133396163626361303531353138363534666436373962376165663739363165663137363265
          353462393661623866333338616665303238

  tasks:
    - name: Install required packages
      shell: |
        curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-9.0.3-amd64.deb 
        sudo dpkg -i elastic-agent-9.0.3-amd64.deb
        sudo systemctl enable elastic-agent 
        sudo systemctl start elastic-agent 
        sudo elastic-agent enroll --url=https://9d61404d76cf49769b3d3e1f49c2b3c5.fleet.us-east-2.aws.elastic-cloud.com:443 --enrollment-token=SjlaS3RwY0I4cUY0dkVCSFBzZFU6ekdBd1habzhrOVpfUUJzOG4tWGd2QQ==